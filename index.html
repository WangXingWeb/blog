<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>

    <title>主页</title>
    <link rel="stylesheet" href="static/reset.css">
    <link rel="stylesheet" href="comp/mint-ui/mint-ui.css">
    <link rel="stylesheet" href="static/base.css">

    <script src="comp/vue.js"></script>
    <script src="comp/mint-ui/mint-ui.js"></script>
    <script src="comp/util.js"></script>
    <script src="comp/bmob-min.js"></script>
    <script src="comp/bmobMain.js"></script>
</head>
<style>
    .page-tabbar {
        overflow: hidden;
        height: 100vh;
    }
    .page-wrap {
        overflow: auto;
        height: 100%;
        padding-bottom: 100px;
    }
    .content{
        margin: 40px 0 80px;
    }
    .mint-tabbar>.mint-tab-item.is-selected{
        background-color: #fafafa;
    }
    .mint-tabbar{
        background-image: none;
    }
    .mint-tabbar>.mint-tab-item.is-selected .mint-tab-item-label{
        color:#dc4036;
    }
    .mint-tab-item-label{
        color:#707070;
    }
</style>
<body>
<div id="blogList">
    <mt-header fixed  title="星仔笔记" class="wx-header">
        <mt-button icon="back" slot="left">返回</mt-button>
        <mt-button icon="more" slot="right"></mt-button>
    </mt-header>
    <div class="page-tabbar">
        <div class="page-wrap">
            <mt-tab-container class="page-tabbar-container content" v-model="selected">
                <mt-tab-container-item id="0">
                    <ul class="blogList">
                        <li class="blog" v-for="blog in blogs" v-on:click="readBlog(blog.id)">
                            <div class="img-contianer" v-if="getImg(blog.attributes.content)">
                                <img v-bind:src="getImg(blog.attributes.content)" v-bind:alt="blog.attributes.title">
                            </div>
                            <div class="info">
                                <div class="title">{{blog.attributes.title}}</div>
                                <div class="blog-content">{{getContent(blog.attributes.content)}}</div>
                                <div class="blog-time" v-html="resetTime(blog.createdAt)"></div>
                            </div>
                        </li>
                    </ul>
                </mt-tab-container-item>
                <mt-tab-container-item id="1">
                    <mt-cell v-for="n in 5" :title="'订单 ' + n" />
                </mt-tab-container-item>
                <mt-tab-container-item id="2">
                    <mt-cell v-for="n in 7" :title="'发现 ' + n" />
                </mt-tab-container-item>

            </mt-tab-container>
        </div>
        <!--tabbar-->
        <mt-tabbar v-model="selected" fixed>
            <mt-tab-item id="0">
                <img slot="icon" v-if="selected==0" src="images/blog-active.png">
                <img slot="icon" v-else src="images/blog.png">
                博客
            </mt-tab-item>
            <mt-tab-item id="1">
                <img slot="icon" v-if="selected==1" src="images/discover-active.png">
                <img slot="icon" v-else src="images/discover.png">
                发现
            </mt-tab-item>
            <mt-tab-item id="2">
                <img slot="icon" v-if="selected==2" src="images/mine-active.png">
                <img slot="icon" v-else src="images/mine.png">
                我的
            </mt-tab-item>
        </mt-tabbar>
    </div>
</div>
</body>
<script>
    new Vue({
        el:"#blogList",
        data: {
            selected:"0",
            userId:'',
            blogs:{}
        },
        created:function () {
            mainBmob.init();
            var currentUser = Bmob.User.current();

            this.userId=currentUser.id;
            console.log(this.userId);
            this.getList();
        },
        watch:{
            selected:function () {
                if(this.selected==0){
                    this.getList();
                }
            }
        },
        methods:{
            getList:function () {
                var _this=this;
                this.$indicator.open();
                mainBmob.equalTo('Blog','author',_this.userId).then(function (data) {
                    if(data.code==200){
                        _this.blogs=data.list;
                        console.log(data.list);
                        _this.$indicator.close();
                    }else{
                        console.log(data.error.code+data.error.message);
                    }
                });
                _this.$indicator.close();
            },
            getContent:function (str) {
                return pickupText(str,50);
            },
            getImg:function (str) {
                var imgs=pickupImg(str,1);
                if(imgs.length==0){
                    return false;
                }
                return imgs[0];
            },
            resetTime:function (time) {
                return dateFormat(time,'yyyy.MM.dd hh:mm');
            },
            readBlog:function (id) {
                window.location.href = 'viewBlog.html?id='+id;
            }
        }
    });
</script>
</html>